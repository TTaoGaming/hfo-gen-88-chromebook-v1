# Medallion: Bronze | Mutation: 0% | HIVE: I
# Provenance: Omega Gen 4 HIVE Spec v6.0 - "Schmitt Trigger / Leaky Bucket"

mission: Thread Omega
generation: 4
version: 6.0
medallion: Bronze
status: Blueprinting V6

# üêù HFO HIVE Base 8 Workflow alignment
workflow_sequence:
  1_hunt:
    ports: [0, 7]
    focus: [Hindsight, Hyper-heuristics]
    p0_sense:
      role: ISR / Observer
      logic: MediaPipe Gesture Recognition + Landmark Extraction (21 Points)
      tunables:
        min_detection_confidence: 0.7 # Hardened for V6
        min_tracking_confidence: 0.7
        model_complexity: 1
    p7_navigate:
      role: BMC2 / Navigator
      logic: Coordinate Mapping & Global Orchestration
      tunables:
        canvas_parity_ratio: 1.0
        coordinate_flip_x: true
        active_camera_id: "default"

  2_interlock:
    ports: [1, 6]
    focus: [Insight, Interfaces]
    p1_fuse:
      role: Data Fabric / Bridger
      logic: Zod 6.0 Schema Bridge + Palm-Cone Orientation Validation
      tunables:
        one_euro_filter_beta: 0.05
        one_euro_filter_mincutoff: 1.0
        palm_facing_threshold: 0.5 # Normal.z dot product
    p6_store:
      role: AAR / Assimilator
      logic: Telemetry Cache (DuckDB/Parquet)
      tunables:
        logging_interval_ms: 100
        buffer_size: 500

  3_validate:
    ports: [2, 5]
    focus: [Foresight, Vanguards]
    p2_shape:
      role: Digital Twin / Shaper
      logic: Leaky Bucket Hysteresis Physics + Visualization
      tunables:
        bucket_capacity: 100.0
        fill_rate_per_frame: 2.5
        drain_rate_per_frame: 1.5
        hysteresis_high_threshold: 85.0
        hysteresis_low_threshold: 15.0
        schmitt_trigger_mode: true
    p5_defend:
      role: Zero Trust / Immunizer
      logic: Forensic Integrity Audit & Purity Gates
      tunables:
        audit_frequency_hz: 1
        purity_threshold: 0.88

  4_evolve:
    ports: [3, 4]
    focus: [Evolutionary Strange Loop, Engines]
    p3_deliver:
      role: Effect Delivery / Injector
      logic: W3C Pointer Injection & FSM Dispatch (Commit on Hysteresis High)
    p4_disrupt:
      role: MDO / Disruptor
      logic: Feedback Loops & Adversarial Jitter Suppression
      tunables:
        jitter_suppression_ratio: 0.05
        low_velocity_deadzone: 0.02

# üïπÔ∏è FSM & Multi-User Logic
fsm_logic:
  states: [IDLE, READY, COMMIT, COAST]
  flows:
    - "IDLE -> READY -> COMMIT -> IDLE"
    - "IDLE -> READY -> IDLE"
    - "* -> COAST -> (Snaplock/Snapback)"
  transitions:
    IDLE_TO_READY:
      trigger: "Palm Facing + Leaky Bucket >= High Threshold"
      logic: "dwell_hysteresis"
    READY_TO_COMMIT:
      trigger: "Preferred Gesture (e.g., Pointer_Up) + Confidence >= Threshold"
      logic: "gesture_trigger"
    COMMIT_TO_IDLE:
      trigger: "Palm Exit OR Manual Release"
      logic: "sequential_reset"
    READY_TO_IDLE:
      trigger: "Palm Not Facing OR Leaky Bucket <= Low Threshold"
      logic: "dwell_loss"
    ANY_TO_COAST:
      trigger: "Tracking Confidence < Coast Threshold"
      logic: "predictive_drift"
      description: "Engineer for consumer hardware tracking loss. Coast the pointer using last known velocity until physics system (P2) is ready."
      timeout_ms: 150
    COAST_TO_SNAPLOCK:
      trigger: "Tracking Resumed + Confidence >= Snap Threshold"
      logic: "proximity_lock"
      description: "Smoothly snap to resumed tracking location if within proximity threshold."
    COAST_TO_IDLE:
      trigger: "Timeout Exceeded"
  pre_arm_behavior:
    description: "Anti-Midas Dwell Persistence. The leaky bucket drains slowly, allowing rapid re-arming if the user re-enters the cone quickly (Coyote Time Pattern)."
    leaky_bucket_persistence: true
    drain_factor: 0.5 # Slower drain than fill for re-entry grace
  activation_gate:
    logic: Palm Orientation Gated Dwell + Leaky Bucket
    visuals:
      type: "Vertical Charge-Up Bar"
      location: "Palm Center (Landmark 0-5-17 Geometric Mean)"
      markers: ["High Threshold", "Low Threshold"]
      color_map: { idling: "#444", charging: "#f00", locked: "#ff0", coasting: "#00f" }
    behavior:
      palm_orientation_required: true
      dwell_activation_ms: 300
      leaky_bucket_hysteresis: true
      hysteresis_high: 85.0
      hysteresis_low: 15.0

# üõ†Ô∏è System Configuration
ui_patterns:
  exposure: Progressive Disclosure
  theme: Red/Black HFO Shards
  transparency: 0.7
  charge_bar_width: 8
  charge_bar_height: 40
