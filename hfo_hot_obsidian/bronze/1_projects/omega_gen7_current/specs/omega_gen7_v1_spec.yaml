# Medallion: Bronze | Mutation: 0% | HIVE: V
# Omega Mission Thread — Gen7 v1 (Starting Point)
# Focus: Multi-hand knuckle tripplane → velocity + predictiveLookaheadMs → key press/release
# Provenance: Gen6 v23.10 baseline; Gen7 v1 is a migration starting point.

meta:
  generation: 7
  version: 1
  status: "bronze-starting-point"
  intent:
    - "Migrate forward from Gen6 v23.10 without losing offline-ready resources (OpenFeature + local libs)."
    - "Center the interaction loop on tripplane-driven keyboard press/release (not pointer clicks)."
    - "Make predictiveLookaheadMs and key mapping hot-swappable via the Port7 Navigator microkernel settings UI."

entrypoint:
  base:
    html: hfo_hot_obsidian/bronze/1_projects/omega_gen7_current/app/omega_gen6_v23_10.html
  target:
    html: hfo_hot_obsidian/bronze/1_projects/omega_gen7_current/app/omega_gen7_v1.html

scope:
  in_scope:
    - "Multi-hand: support N cursors/hands (at least 2) in the tripplane→key pipeline."
    - "Tripplane: use knuckle tripplane distance + velocity to derive direction and robust begin/end edges."
    - "Predictive: use predictiveLookaheadMs (TTC/TOI window) to optionally schedule early keydown before crossing."
    - "Port7: expose tuning controls in Navigator microkernel UI (lil-gui) and apply live without reload."
  out_of_scope:
    - "Gen7 multi-finger (index/middle/ring/pinky) chord mapping (tracked as future Gen7 v2+)."
    - "Contract hardening across Zod ports (tracked as Silver promotion work)."

ports:
  p1_data_fabric:
    cursors:
      description: "Fused cursor streams; each cursor maps to a hand instance for tripplane evaluation."
      required_fields:
        - handIndex
        - pointerId
        - fsmState
        - readinessScore
        - uiNormX
        - uiNormY
        - landmarks

  p2_shape:
    knuckle_tripplane:
      description: "Per-cursor knuckle tripplane and predictive TTC estimation (TOI/TTC)."
      per_cursor_inputs:
        - landmarks[0]  # wrist
        - landmarks[5]  # index knuckle
        - landmarks[17] # pinky knuckle
        - landmarks[8]  # index fingertip
      outputs:
        tripwire_cross_event:
          type: "p2/tripwire_cross"
          payload_fields:
            - sensorId: "knuckle"
            - sensor.phase: "begin|end"
            - direction: "down|up"
            - speedUiNormPerS
            - sensor.distance.orientedDistanceVelUiNormPerS
        tripplane_lookahead_event:
          type: "p2/tripplane_lookahead"
          payload_fields:
            - sensorId: "knuckle"
            - ttcMs
            - lookaheadWindowMs
            - orientedDistanceVelUiNormPerS

  p3_deliver:
    tripplane_key_injector:
      description: "Consumes p2 tripplane events and injects keyboard edges (keydown/keyup) gated by COMMIT and deadman; supports predictive early keydown scheduling."
      key_mapping_policy:
        - "Key mapping is configurable per-handIndex (and later per handKey once stable identity lands)."
        - "Default mapping may be identical for all hands (Space), but must be overrideable."
      velocity_policy:
        - "Press/release may optionally require minimum velocity thresholds to reduce jitter."

  p7_navigate:
    navigator_microkernel:
      description: "Hot-swap tuning surface (lil-gui) for Gen7 v1 tripplane→key behavior."
      required_controls:
        - "predictiveLookaheadMs / lookaheadWindowMs (ms)"
        - "predictive scheduling bias (ms)"
        - "enable/disable predictive scheduling"
        - "per-hand key code mapping (handIndex→KeyboardEvent.code)"
        - "optional min speed thresholds for begin/end edges"

migration_notes:
  carry_forward:
    - "Offline-ready OpenFeature + local module map is already present in Gen6 v23.10; Gen7 v1 must preserve that posture."
    - "Hand identity stability (coast + snaplock + anchoring) remains a known pain point; v24 notes remain relevant as guidance for future Gen7 multi-hand identity hardening."

validation:
  posture: "Bronze smoke checks only."
  acceptance_criteria:
    - "Gen7 v1 loads and behaves identically to v23.10 by default when tripplane key mapping remains Space."
    - "Port7 Navigator can change predictiveLookaheadMs (lookaheadWindowMs) live and affect scheduling behavior."
    - "Port7 Navigator can change injected key code (at least handIndex 0/1) live without reload."
    - "Tripplane begin emits keydown and end emits keyup (COMMIT-gated + deadman fail-closed)."

sources:
  - hfo_hot_obsidian/bronze/3_resources/para/omega_gen6_current/omega_gen6_v23_10.html
  - hfo_hot_obsidian/bronze/3_resources/para/omega_gen6_current/specs/omega_gen6_v24_spec.yaml
