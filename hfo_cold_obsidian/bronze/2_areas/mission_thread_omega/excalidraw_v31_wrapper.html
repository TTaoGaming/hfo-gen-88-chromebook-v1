<!-- Medallion: Cold Bronze | Mutation: 0% | HIVE: V -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>HFO Excalidraw Wrapper</title>
    <!-- ðŸ“¦ React & Excalidraw UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin
        src="https://unpkg.com/@excalidraw/excalidraw@0.17.6/dist/excalidraw.production.min.js"></script>
    <style>
        body,
        html,
        #app {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #0d0d0d;
        }
    </style>
</head>

<body>
    <div id="app"></div>
    <script>
        window.EXCALIDRAW_ASSET_PATH = "https://unpkg.com/@excalidraw/excalidraw@0.17.6/dist/";

        const render = () => {
            const lib = window.ExcalidrawLib || window.Excalidraw;
            if (!lib) { setTimeout(render, 100); return; }

            const App = () => {
                return React.createElement(lib.Excalidraw, {
                    theme: "dark",
                    UIOptions: { canvasActions: { loadScene: false } },
                    excalidrawAPI: (api) => {
                        window.excalidrawAPI = api;
                        window.parent.postMessage({ type: "EXCALIDRAW_READY" }, "*");
                    }
                });
            };

            // ðŸŒ‰ HFO Bridge: Listen for programmatic commands from parent
            window.addEventListener("message", (event) => {
                if (!window.excalidrawAPI) return;
                const { type, data } = event.data;
                switch (type) {
                    case "SET_TOOL":
                        window.excalidrawAPI.setActiveTool({ type: data.tool });
                        break;
                    case "UPDATE_SCENE":
                        window.excalidrawAPI.updateScene(data);
                        break;
                }
            });

            const root = ReactDOM.createRoot(document.getElementById('app'));
            root.render(React.createElement(App));
        };
        render();
    </script>
</body>

</html>